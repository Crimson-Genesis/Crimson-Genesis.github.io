<!doctype html>
<html lang="en" ng-app="retroApp">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Crimson-Genesis — Papers & Notes (Retro)</title>
    <!-- Retro / Pixel font (press start 2p for header, vt323 for terminal feel) -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <!-- main stylesheet (I'll update it with pixel-art styles later) -->
    <link rel="stylesheet" href="styles.css" />
    <!-- AngularJS + ngSanitize -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-sanitize.min.js"></script>
    <!-- Marked.js for markdown -> HTML -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body ng-controller="MainCtrl as vm" ng-class="vm.theme" class="retro">
    <div class="page pixel-frame">
      <!-- Pixel-art header (SVG monochrome grid) -->
      <header class="header pixel-header">
        <div class="header-left">
          <!-- Small pixel icon made with SVG rectangles -->
          <svg width="72" height="40" viewBox="0 0 72 40" xmlns="http://www.w3.org/2000/svg" class="pixel-logo" role="img" aria-label="Retro logo">
            <!-- Background grid -->
            <rect width="72" height="40" fill="#111" />
            <!-- Yellow pixel blocks -->
            <g fill="#ffd54a">
              <rect x="6" y="6" width="8" height="8"/>
              <rect x="16" y="6" width="8" height="8"/>
              <rect x="6" y="16" width="8" height="8"/>
              <rect x="34" y="6" width="8" height="8"/>
              <rect x="52" y="6" width="8" height="8"/>
              <rect x="34" y="16" width="8" height="8"/>
              <rect x="52" y="16" width="8" height="8"/>
            </g>
          </svg>
          <!-- Pixel-style title using press-start font -->
          <div class="title-block">
            <div class="title-line">Crimson-Genesis</div>
            <div class="subtitle-line">research & notes — 90s retro</div>
          </div>
        </div>
        <div class="header-right">
          <button ng-click="vm.toggleTheme()" class="btn pixel-btn">Toggle theme</button>
        </div>
      </header>
      <main class="main pixel-main">
        <!-- Sidebar with search -->
        <aside class="sidebar pixel-sidebar">
          <h2>Library</h2>
          <!-- Search input -->
          <div class="search-box">
            <label for="search" class="visually-hidden">Search papers</label>
            <input id="search"
                 type="search"
                 ng-model="vm.searchQuery"
                 ng-change="vm.search(vm.searchQuery)"
                 placeholder="Search title or content..."
                 autocomplete="off"
                 class="search-input" />
          </div>
          <p class="small search-info" ng-show="vm.searchQuery">
            Results: <strong>{{vm.filteredCount || 0}}</strong>
          </p>
          <!-- Paper list: will be filtered by controller (vm.filtered) -->
          <ul>
            <li ng-repeat="p in vm.filtered track by $index">
              <a href ng-click="vm.open(p)">{{p.title}}</a>
            </li>
          </ul>
          <hr />
        </aside>
        <!-- Content area -->
        <section class="content pixel-content" aria-label="Document viewer">
          <article id="viewer" class="viewer" role="article" tabindex="0">
            <div ng-if="!vm.current" class="welcome">
              <h2 ng-if="!vm.current">Welcome</h2>
              <p ng-if="!vm.current">This is a retro-styled portfolio. Click a paper on the left to view. PDFs open inside the page; markdown renders as HTML.</p>
            </div>
            <div ng-if="vm.current" class="doc-wrap" style="height:100%; display:flex; flex-direction:column;">
              <h2 class="paper-title">{{vm.current.title}}</h2>
              <!-- Markdown viewer -->
              <div 
                    ng-if="vm.current.type === 'md'" 
                    ng-bind-html="vm.content" 
                    class="md-view"
                    aria-live="polite"
                    role="document">
              </div>
              <!-- PDF viewer -->
              <div ng-if="vm.current.type === 'pdf'" style="display:flex; flex-direction:column; height:100%;">
                <!-- ng-src will be trusted by app.js when opened -->
                <iframe 
                    <!-- ng-src="{{vm.current.path}}"  -->
                  ng-src="vm.trustedPdf(vm.current)"
                  title="PDF viewer" 
                  ng-attr-sandbox="{{ vm.current && vm.current._sandbox || undefined }}"
                  style="width:100%; height:100%; border:0; display:block;"
                  allowfullscreen
                  referrerpolicy="no-referrer">
                  ></iframe>
                <p class="small" style="margin-top:8px;"><a href="{{vm.current.path}}" target="_blank" rel="noopener">Open PDF in new tab</a></p>
              </div>
            </div>
          </article>
        </section>
      </main>
      <footer class="footer pixel-footer">
        <p>Hosted with ❤️ on GitHub Pages — <span class="muted">Not peer-reviewed unless stated</span></p>
      </footer>
    </div>
    <!-- App script (controller + search logic will go here next) -->
    <script src="app.js"></script>
  </body>
</html>
